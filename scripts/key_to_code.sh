#!/usr/bin/env zsh
set -euo pipefail
IFS=$'\n\t'

typeset -A keymap

# https://pickpj.github.io/keycodes.html
# sudo libinput record --show-keycodes
case "$(swaymsg -t get_inputs |\
    jq -r '.[]|select(.type=="keyboard" and .name=="ydotoold virtual device") |"\(.xkb_active_layout_name)"' |\
    tr '[:upper:]' '[:lower:]')" in
    *german*)

    keymap['']='1:1 1:0'
    keymap['<ESC>']='1:1 1:0'
    keymap['']='14:1 14:0'
    keymap['<BS>']='14:1 14:0'
    keymap['	']='15:1 15:0'
    keymap['<Tab>']='15:1 15:0'
    keymap['']='28:1 28:0'
    keymap['<Ret>']='28:1 28:0'
    keymap['<C>']='29:1 29:0'
    keymap['<Cl>']='29:1 29:0'
    keymap['<S>']='42:1 42:0'
    keymap['<Sl>']='42:1 42:0'
    keymap['<Sr>']='54:1 54:0'
    keymap['<K*>']='55:1 55:0'
    keymap['<A>']='56:1 56:0'
    keymap['<Al>']='56:1 56:0'
    keymap['<CapsLock>']='58:1 58:0'
    keymap['<NumLock>']='69:1 69:0'
    keymap['<Scroll>']='70:1 70:0'
    keymap['<Cr>']='97:1 97:0'
    keymap['<Ar>']='100:1 100:0'
    keymap['<AGr>']='100:1 100:0'
    keymap['<Super>']='125:1 125:0'
    keymap['<Superl>']='125:1 125:0'
    keymap['<Superr>']='125:1 125:0'
    keymap['<ContextMenu>']='126:1 126:0'
    keymap['<Compose>']='126:1 126:0'

    ${samelength-false} && d="delay delay " || d=

    keymap['1']="$d"'2:1 2:0'
    keymap['2']="$d"'3:1 3:0'
    keymap['3']="$d"'4:1 4:0'
    keymap['4']="$d"'5:1 5:0'
    keymap['5']="$d"'6:1 6:0'
    keymap['6']="$d"'7:1 7:0'
    keymap['7']="$d"'8:1 8:0'
    keymap['8']="$d"'9:1 9:0'
    keymap['9']="$d"'10:1 10:0'
    keymap['0']="$d"'11:1 11:0'
    keymap['ß']="$d"'12:1 12:0'
    keymap['´']="$d"'13:1 13:0'
    keymap['q']="$d"'16:1 16:0'
    keymap['w']="$d"'17:1 17:0'
    keymap['e']="$d"'18:1 18:0'
    keymap['r']="$d"'19:1 19:0'
    keymap['t']="$d"'20:1 20:0'
    keymap['z']="$d"'21:1 21:0'
    keymap['u']="$d"'22:1 22:0'
    keymap['i']="$d"'23:1 23:0'
    keymap['o']="$d"'24:1 24:0'
    keymap['p']="$d"'25:1 25:0'
    keymap['ü']="$d"'26:1 26:0'
    keymap['+']="$d"'27:1 27:0'
    keymap['a']="$d"'30:1 30:0'
    keymap['s']="$d"'31:1 31:0'
    keymap['d']="$d"'32:1 32:0'
    keymap['f']="$d"'33:1 33:0'
    keymap['g']="$d"'34:1 34:0'
    keymap['h']="$d"'35:1 35:0'
    keymap['j']="$d"'36:1 36:0'
    keymap['k']="$d"'37:1 37:0'
    keymap['l']="$d"'38:1 38:0'
    keymap['ö']="$d"'39:1 39:0'
    keymap['ä']="$d"'40:1 40:0'
    keymap['^']="$d"'41:1 41:0'
    keymap['#']="$d"'43:1 43:0'
    keymap['y']="$d"'44:1 44:0'
    keymap['x']="$d"'45:1 45:0'
    keymap['c']="$d"'46:1 46:0'
    keymap['v']="$d"'47:1 47:0'
    keymap['b']="$d"'48:1 48:0'
    keymap['n']="$d"'49:1 49:0'
    keymap['m']="$d"'50:1 50:0'
    keymap[',']="$d"'51:1 51:0'
    keymap['.']="$d"'52:1 52:0'
    keymap['-']="$d"'53:1 53:0'
    keymap[' ']="$d"'57:1 57:0'
    keymap['<F1>']='59:1 59:0'
    keymap['<F2>']='60:1 60:0'
    keymap['<F3>']='61:1 61:0'
    keymap['<F4>']='62:1 62:0'
    keymap['<F5>']='63:1 63:0'
    keymap['<F6>']='64:1 64:0'
    keymap['<F7>']='65:1 65:0'
    keymap['<F8>']='66:1 66:0'
    keymap['<F9>']='67:1 67:0'
    keymap['<F10>']='68:1 68:0'
    keymap['<K7>']="$d"'71:1 71:0'
    keymap['<K8>']="$d"'72:1 72:0'
    keymap['<K9>']="$d"'73:1 73:0'
    keymap['<K->']="$d"'74:1 74:0'
    keymap['<K4>']="$d"'75:1 75:0'
    keymap['<K5>']="$d"'76:1 76:0'
    keymap['<K6>']="$d"'77:1 77:0'
    keymap['<K+>']="$d"'78:1 78:0'
    keymap['<K1>']="$d"'79:1 79:0'
    keymap['<K2>']="$d"'80:1 80:0'
    keymap['<K3>']="$d"'81:1 81:0'
    keymap['<K0>']="$d"'82:1 82:0'
    keymap['<K.>']="$d"'83:1 83:0'
    keymap['<']="$d"'86:1 86:0'
    keymap['<F11>']='87:1 87:0'
    keymap['<F12>']='88:1 88:0'
    keymap['<KRet>']='96:1 96:0'
    keymap['<K/>']='98:1 98:0'
    keymap['<Prt>']='99:1 99:0'
    keymap['<Sys>']='99:1 99:0'
    keymap['<Home>']='102:1 102:0'
    keymap['<Up>']='103:1 103:0'
    keymap['↑']='103:1 103:0'
    keymap['<PgUp>']='104:1 104:0'
    keymap['<Left>']='105:1 105:0'
    keymap['←']='105:1 105:0'
    keymap['<Right>']='106:1 106:0'
    keymap['→']='106:1 106:0'
    keymap['<End>']='107:1 107:0'
    keymap['<Down>']='108:1 108:0'
    keymap['↓']='108:1 108:0'
    keymap['<PgDown>']='109:1 109:0'
    keymap['<Insert>']='110:1 110:0'
    keymap['<Delete>']='111:1 111:0'
    keymap['<Mute>']='113:1 113:0'
    keymap['<VolUp>']='114:1 114:0'
    keymap['<VolDown>']='115:1 115:0'
    keymap['<Power>']='116:1 116:0'
    keymap['<K=>']='117:1 117:0'
    keymap['<K±>']='118:1 118:0'
    keymap['<Pause>']='119:1 119:0'
    keymap['<K.>']='121:1 121:0'
    # Shift
    keymap['°']='42:1 41:1 41:0 42:0'
    keymap['!']='42:1 2:1 2:0 42:0'
    keymap['"']='42:1 3:1 3:0 42:0'
    keymap['§']='42:1 4:1 4:0 42:0'
    keymap['$']='42:1 5:1 5:0 42:0'
    keymap['%']='42:1 6:1 6:0 42:0'
    keymap['&']='42:1 7:1 7:0 42:0'
    keymap['/']='42:1 8:1 8:0 42:0'
    keymap['(']='42:1 9:1 9:0 42:0'
    keymap[')']='42:1 10:1 10:0 42:0'
    keymap['=']='42:1 11:1 11:0 42:0'
    keymap['?']='42:1 12:1 12:0 42:0'
    keymap['`']='42:1 13:1 13:0 42:0'
    keymap['Q']='42:1 16:1 16:0 42:0'
    keymap['W']='42:1 17:1 17:0 42:0'
    keymap['E']='42:1 18:1 18:0 42:0'
    keymap['R']='42:1 19:1 19:0 42:0'
    keymap['T']='42:1 20:1 20:0 42:0'
    keymap['Z']='42:1 21:1 21:0 42:0'
    keymap['U']='42:1 22:1 22:0 42:0'
    keymap['I']='42:1 23:1 23:0 42:0'
    keymap['O']='42:1 24:1 24:0 42:0'
    keymap['P']='42:1 25:1 25:0 42:0'
    keymap['Ü']='42:1 26:1 26:0 42:0'
    keymap['*']='42:1 27:1 27:0 42:0'
    keymap['A']='42:1 30:1 30:0 42:0'
    keymap['S']='42:1 31:1 31:0 42:0'
    keymap['D']='42:1 32:1 32:0 42:0'
    keymap['F']='42:1 33:1 33:0 42:0'
    keymap['G']='42:1 34:1 34:0 42:0'
    keymap['H']='42:1 35:1 35:0 42:0'
    keymap['J']='42:1 36:1 36:0 42:0'
    keymap['K']='42:1 37:1 37:0 42:0'
    keymap['L']='42:1 38:1 38:0 42:0'
    keymap['Ö']='42:1 39:1 39:0 42:0'
    keymap['Ä']='42:1 40:1 40:0 42:0'
    keymap["'"]='42:1 43:1 43:0 42:0'
    keymap['Y']='42:1 44:1 44:0 42:0'
    keymap['X']='42:1 45:1 45:0 42:0'
    keymap['C']='42:1 46:1 46:0 42:0'
    keymap['V']='42:1 47:1 47:0 42:0'
    keymap['B']='42:1 48:1 48:0 42:0'
    keymap['N']='42:1 49:1 49:0 42:0'
    keymap['M']='42:1 50:1 50:0 42:0'
    keymap[';']='42:1 51:1 51:0 42:0'
    keymap[':']='42:1 52:1 52:0 42:0'
    keymap['_']='42:1 53:1 53:0 42:0'
    keymap['>']='42:1 86:1 86:0 42:0'
    # Alt Gr
    keymap['¹']='100:1 2:1 2:0 100:0'
    keymap['²']='100:1 3:1 3:0 100:0'
    keymap['³']='100:1 4:1 4:0 100:0'
    keymap['¼']='100:1 5:1 5:0 100:0'
    keymap['½']='100:1 6:1 6:0 100:0'
    keymap['¬']='100:1 7:1 7:0 100:0'
    keymap['{']='100:1 8:1 8:0 100:0'
    keymap['[']='100:1 9:1 9:0 100:0'
    keymap[']']='100:1 10:1 10:0 100:0'
    keymap['}']='100:1 11:1 11:0 100:0'
    keymap['\']='100:1 12:1 12:0 100:0'
    keymap['¸']='100:1 13:1 13:0 100:0'
    keymap['@']='100:1 16:1 16:0 100:0'
    keymap['ſ']='100:1 17:1 17:0 100:0'
    keymap['€']='100:1 18:1 18:0 100:0'
    keymap['¶']='100:1 19:1 19:0 100:0'
    keymap['ŧ']='100:1 20:1 20:0 100:0'
    keymap['<←>']='100:1 21:1 21:0 100:0'
    keymap['<↓>']='100:1 22:1 22:0 100:0'
    keymap['<→>']='100:1 23:1 23:0 100:0'
    keymap['ø']='100:1 24:1 24:0 100:0'
    keymap['þ']='100:1 25:1 25:0 100:0'
    keymap['¨']='100:1 26:1 26:0 100:0'
    keymap['~']='100:1 27:1 27:0 100:0'
    keymap['æ']='100:1 30:1 30:0 100:0'
    keymap['ſ']='100:1 31:1 31:0 100:0'
    keymap['ð']='100:1 32:1 32:0 100:0'
    keymap['đ']='100:1 33:1 33:0 100:0'
    keymap['ŋ']='100:1 34:1 34:0 100:0'
    keymap['ħ']='100:1 35:1 35:0 100:0'
    keymap['ĸ']='100:1 37:1 37:0 100:0'
    keymap['ł']='100:1 38:1 38:0 100:0'
    keymap['˝']='100:1 39:1 39:0 100:0'
    keymap['’']='100:1 43:1 43:0 100:0'
    keymap['»']='100:1 44:1 44:0 100:0'
    keymap['«']='100:1 45:1 45:0 100:0'
    keymap['¢']='100:1 46:1 46:0 100:0'
    keymap['“']='100:1 48:1 48:0 100:0'
    keymap['”']='100:1 49:1 49:0 100:0'
    keymap['µ']='100:1 50:1 50:0 100:0'
    keymap['·']='100:1 51:1 51:0 100:0'
    keymap['…']='100:1 52:1 52:0 100:0'
    keymap['–']='100:1 53:1 53:0 100:0'
    keymap['|']='100:1 86:1 86:0 100:0'
    # Shift+Alt Gr
    keymap['¡']='42:1 100:1 2:1 2:0 100:0 42:0'
    keymap['⅛']='42:1 100:1 3:1 3:0 100:0 42:0'
    keymap['£']='42:1 100:1 4:1 4:0 100:0 42:0'
    keymap['¤']='42:1 100:1 5:1 5:0 100:0 42:0'
    keymap['⅜']='42:1 100:1 6:1 6:0 100:0 42:0'
    keymap['⅝']='42:1 100:1 7:1 7:0 100:0 42:0'
    keymap['⅞']='42:1 100:1 8:1 8:0 100:0 42:0'
    keymap['™']='42:1 100:1 9:1 9:0 100:0 42:0'
    keymap['±']='42:1 100:1 10:1 10:0 100:0 42:0'
    keymap['°']='42:1 100:1 11:1 11:0 100:0 42:0'
    keymap['¿']='42:1 100:1 12:1 12:0 100:0 42:0'
    keymap['˛']='42:1 100:1 13:1 13:0 100:0 42:0'
    keymap['Ω']='42:1 100:1 16:1 16:0 100:0 42:0'
    keymap['®']='42:1 100:1 19:1 19:0 100:0 42:0'
    keymap['Ŧ']='42:1 100:1 20:1 20:0 100:0 42:0'
    keymap['¥']='42:1 100:1 21:1 21:0 100:0 42:0'
    keymap['<↑>']='42:1 100:1 22:1 22:0 100:0 42:0'
    keymap['ı']='42:1 100:1 23:1 23:0 100:0 42:0'
    keymap['Ø']='42:1 100:1 24:1 24:0 100:0 42:0'
    keymap['Þ']='42:1 100:1 25:1 25:0 100:0 42:0'
    keymap['°']='42:1 100:1 26:1 26:0 100:0 42:0'
    keymap['¯']='42:1 100:1 27:1 27:0 100:0 42:0'
    keymap['Æ']='42:1 100:1 30:1 30:0 100:0 42:0'
    keymap['ẞ']='42:1 100:1 31:1 31:0 100:0 42:0'
    keymap['ª']='42:1 100:1 33:1 33:0 100:0 42:0'
    keymap['Ŋ']='42:1 100:1 34:1 34:0 100:0 42:0'
    keymap['Ħ']='42:1 100:1 35:1 35:0 100:0 42:0'
    keymap['˙']='42:1 100:1 36:1 36:0 100:0 42:0'
    keymap['Ł']='42:1 100:1 38:1 38:0 100:0 42:0'
    keymap['ˇ']='42:1 100:1 40:1 40:0 100:0 42:0'
    keymap['›']='42:1 100:1 44:1 44:0 100:0 42:0'
    keymap['‹']='42:1 100:1 45:1 45:0 100:0 42:0'
    keymap['©']='42:1 100:1 46:1 46:0 100:0 42:0'
    keymap['‚']='42:1 100:1 47:1 47:0 100:0 42:0'
    keymap['‘']='42:1 100:1 48:1 48:0 100:0 42:0'
    keymap['’']='42:1 100:1 49:1 49:0 100:0 42:0'
    keymap['º']='42:1 100:1 50:1 50:0 100:0 42:0'
    keymap['×']='42:1 100:1 51:1 51:0 100:0 42:0'
    keymap['÷']='42:1 100:1 52:1 52:0 100:0 42:0'
    keymap['—']='42:1 100:1 53:1 53:0 100:0 42:0'
        ;;
    *)
        echo "Unsupported layout!" >&2
esac


stdin_to_ydotool_codes() {
    grep -o . | while read -r c; do printf '%s ' "${keymap["$c"]}"
done
}
